<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Writing a PrimitiveTool - iModel.js</title>
    <meta name="og:title" content="Writing a PrimitiveTool - iModel.js">
    <meta name="twitter:title" content="Writing a PrimitiveTool - iModel.js">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/bundle.css">

    <!-- bootstrap -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!-- fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"> 
    
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/devRegistration.css"> 
    
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/landingPage.css">  
        <link rel='shortcut icon' type='image/x-icon' href='https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs_16.png' /> 
        <meta property="og:description" content="Create Immersive Connections with your Infrastructure Digital Twin."><meta property="og:url" content="imodeljs.org"><meta name="twitter:card" content="summary_large_image">
        <meta property="og:image" content="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/twitter-share.png">
        <meta />
</head>

<body data-site-root=https://imodeljs.github.io/iModelJs-docs-output// class='layout-index '>
    <span id="contentLoader">
        <p>Woah! This page has a great deal of content... Give us a second to load it.</p>
    </span>
    <span id="contentLoaderBackground"></span>
    <div id="flex-wrapper">



        <header id="main-header">
            <div class='nav-header-container'>
                <nav class="navbar nav-main-header navbar-expand-md fixed-top navbar-light pb-0">
                    <a href="https://imodeljs.github.io/iModelJs-docs-output//" class="navbar-brand">
                            <img id="site-logo" class="site-logo" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-logo.svg" /> 
                            <img id="site-logo-small" class="site-logo-small" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-icon.svg" style="display:none;"/> 
                    </a>
                    <button class="navbar-toggler no-user-select mr-auto" type="button" data-toggle="collapse" data-target="#navbar5">
                        <span class="navbar-toggler-header"></span>
                    </button>
                    <ul class="navbar-nav ml-auto pr-0 nav-search">
                        <span class='search-bar'>
                          <li>
                            <div id='search-container'>
                            </div>
                          </li>
                          <script>
                            (function() {
                              var cx = '018053174497532353467:v_gnrjjlqwc';
                              var gcse = document.createElement('script');
                              gcse.type = 'text/javascript';
                              gcse.async = true;
                              gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                              var s = document.getElementsByTagName('script')[0];
                              s.parentNode.insertBefore(gcse, s);
                            })();
                          </script>
                          <gcse:searchresults-only gname="sitesearch" resultSetSize="7"></gcse:search>
                        </span>
                    </ul>
                    <div class="navbar-collapse collapse justify-content-stretch" id="navbar5">
                        <ul class="navbar-nav mb-0" id="doc-site-tabs">
                                <li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//getting-started">Getting Started</a></li><li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//bis">BIS</a></li><li class="nav-item active"><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//learning">Learning</a></li><li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//reference">API Reference</a></li><li class="nav-item change-history-tab "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//changehistory">v1.4.0</a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
<div id='main-wrapper'>
    <nav id='sidebar'>
        <div id='table-of-contents' class="custom-scrollbar">
            <div id="dismiss">
                <i id="dismiss-arrow" class="icon icon-chevron-left no-user-select"></i>
            </div>
            <hr id="dismiss-hr" class='sm-only'>
            <ul id='main-navigation-list'>
                <html><head></head><body><h3 id="the imodel.js library"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/" class="table-of-contents-link">The iModel.js Library</a></h3>
    <ul>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/frontend/" class="table-of-contents-link">Frontend</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/backend/" class="table-of-contents-link">Backend</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/common/" class="table-of-contents-link">Common</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/geometry/" class="table-of-contents-link">Geometry</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/presentation/" class="table-of-contents-link">Presentation</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/ui/" class="table-of-contents-link">UI</a></li>
    </ul>
    <hr>
    <p>&#xA0;</p>
    <h3 id="helpful links">Helpful links</h3>
    <ul>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/ecsql" class="table-of-contents-link">ECSQL</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/imodelhub/" class="table-of-contents-link">iModelHub</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/wireformat" class="table-of-contents-link">Wire Format</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/faq" class="table-of-contents-link">Frequently Asked Questions</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/guidelines/" class="table-of-contents-link">Guidelines and Tips</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/glossary" class="table-of-contents-link">Glossary</a></li>
    </ul>
    </body></html>
            </ul>
        </div>
    </nav>    <div class='documentation-main'>
        <article id="main" class="main-content">
            <button type="button" id="sidebarCollapse" class="no-user-select"> <i class="bread-crumb-label bread-crumb-expand-leftnav icon icon-chevron-right no-user-select" id="expand-leftnav"></i></button><div class='bread-crumb-label'><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/">Learning</a> > <a href="https://imodeljs.github.io/iModelJs-docs-output//learning/frontend/">frontend</a> > PrimitiveTools</div>
            <div class="edit-link"><a href="https://github.com/imodeljs/imodeljs/tree/master/docs/learning/frontend/PrimitiveTools.md">Edit this page</a></div>
            <h1 id="writing a primitivetool">Writing a PrimitiveTool</h1>
<p>The <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/primitivetool'>PrimitiveTool</a> class serves as the base class for tools that need to create or modify geometric elements. An application&apos;s Primitive tools are often very specialized with each serving a single and specific purpose. Understanding of PrimitiveTool methods and what is expected from sub-classes is necessary for creating tools that conform to user expectations and exhibit consistent behavior.</p>
<h2 class="h-running-the-tool">Running the tool<a id="running-the-tool" class="heading-anchor" href="#running-the-tool"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>Because Primitive tools often target a specific type of element, it may be undesirable to install a given Primitive tool as the <em>active</em> tool without first checking if all required conditions are being met.</p>
<p>When <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/toolregistry/run'>ToolRegistry.run</a> is called for a Primitive tool, the following sequence of tool methods are called:</p>
<ul>
<li><a href="#iscompatibleviewport">isCompatibleViewport</a></li>
<li><a href="#oninstall">onInstall</a></li>
<li><a href="#onpostinstall">onPostInstall</a></li>
</ul>
<pre class="no-line-numbers"><code class="language-typescript">  public run(): boolean {
    const { toolAdmin, viewManager } = IModelApp;
    if (!this.isCompatibleViewport(viewManager.selectedView, false) || !toolAdmin.onInstallTool(this))
      return false;

    toolAdmin.startPrimitiveTool(this);
    toolAdmin.onPostInstallTool(this);
    return true;
  }</code></pre>
<h2 class="h-iscompatibleviewport">isCompatibleViewport<a id="iscompatibleviewport" class="heading-anchor" href="#iscompatibleviewport"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>The very first decision the tool must make is whether to continue the install or leave the current tool active given a viewport identifying the target for graphical interaction. By default <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/views/viewmanager/#selectedview'>ViewManager.selectedView</a> is supplied as the target viewport by <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/primitivetool/run'>PrimitiveTool.run</a>.</p>
<p>The tool is responsible for checking the viewport&apos;s compatibility with the tool operation, some examples below:</p>
<ul>
<li>Target isn&apos;t readonly. Checks <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/primitivetool/#requirewriteabletarget'>PrimitiveTool.requireWriteableTarget</a>, defaults to true; assumption is that <em>most</em> Primitive tools will insert/update elements.</li>
<li>Only applicable to spatial views.</li>
<li>Requires a specific GeometricModel be included in the view&apos;s <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/views/modelselectorstate'>ModelSelectorState</a>.</li>
</ul>
<p>If <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/#iscompatibleviewport'>InteractiveTool.isCompatibleViewport</a> rejects the view, then the current tool remains active and installation of the new tool stops, if the view is accepted, then we proceed to the <a href="#oninstall">onInstall</a> step.</p>
<blockquote>
<p>For applications that support multiple views, <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/onselectedviewportchanged'>InteractiveTool.onSelectedViewportChanged</a> will also call isCompatibleViewport to provide tools an opportunity to decide if they should remain active or must exit depending on their compatibility with the new selected view. The <em>isSelectedViewChange</em> parameter will be true in this situation.</p>
</blockquote>
<pre class="no-line-numbers"><code class="language-typescript">  public onSelectedViewportChanged(_previous: Viewport | undefined, current: Viewport | undefined): void {
    if (this.isCompatibleViewport(current, true))
      return;
    this.onRestartTool();
  }</code></pre>
<blockquote>
<p>Prior to sending a button or motion event to the active tool, isCompatibleViewport is also called. If the tool rejects the view of the would-be motion event, it still remains active and the user is presented with an <em>incompatible</em> view cursor. A data button in an incompatible view will either be ignored (not sent to the tool), or trigger a change of the selected view. The data button behavior is controlled by the state of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/primitivetool/#targetislocked'>PrimitiveTool.targetIsLocked</a>. Ideally a placement tool should allow the selected view to be freely changed by the first data button as long as the new view is compatible, afterwards the target view/model will be considered locked for the tool duration, see <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/primitivetool/#autolocktarget'>PrimitiveTool.autoLockTarget</a>.</p>
</blockquote>
<h2 class="h-oninstall">onInstall<a id="oninstall" class="heading-anchor" href="#oninstall"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>Now that a target view has been accepted for the tool operation, <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/oninstall'>InteractiveTool.onInstall</a> provides one last chance before being set as the active tool to check any remaining requirements. The type of checks to consider for onInstall as opposed to isCompatibleViewport would be one time only initial conditions that would not be appropriate or necessary to test on a motion event, such as:</p>
<ul>
<li>Tool requires an pre-defined <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/selectionset/selectionset'>SelectionSet</a> of existing elements.</li>
</ul>
<blockquote>
<p>Most tools don&apos;t need to override onInstall, as long as it returns true, the new tool is set as the active tool, after which <a href="#onpostinstall">onPostInstall</a> will be called.</p>
</blockquote>
<h2 class="h-onpostinstall">onPostInstall<a id="onpostinstall" class="heading-anchor" href="#onpostinstall"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>After becoming the active tool, <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/#onpostinstall'>InteractiveTool.onPostInstall</a> is used to establish the initial tool state. This may include enabling <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/accusnap'>AccuSnap</a>, sending AccuDraw hints using <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/accudraw/accudrawhintbuilder'>AccuDrawHintBuilder</a>, and showing user prompts. Because onPostInstall is paired with <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/#oncleanup'>InteractiveTool.onCleanup</a>, it&apos;s also a good place to register listeners for events.</p>
<p>Refer to <a href="#accusnap">AccuSnap</a> and <a href="#accudraw">AccuDraw</a> for examples showing how different types of Primitive tools can leverage these drawing aides.</p>
<h2 class="h-onrestarttool">onRestartTool<a id="onrestarttool" class="heading-anchor" href="#onrestarttool"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>A Primitive tool is required to provide an implementation for <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/primitivetool/onrestarttool'>PrimitiveTool.onRestartTool</a>. This method will be called to notify the tool after iModel changes made outside of the tool&apos;s perview have occured which <em>may</em> have invalidated the current tool state.</p>
<ul>
<li>For example, the user requests an undo of their previous action, an element the tool is currently modifying was created in the last transaction and as such no longer exists. The tool is expected to either install a new tool instance, or exit in response to this event.</li>
</ul>
<p>Example of typical implementation for onRestartTool:</p>
<pre class="no-line-numbers"><code class="language-typescript">  public onRestartTool(): void {
    const tool = new SamplePrimitiveTool();
    if (!tool.run())
      this.exitTool();
  }</code></pre>
<blockquote>
<p>The default implementation of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/onselectedviewportchanged'>InteractiveTool.onSelectedViewportChanged</a> also calls onRestartTool to handle <a href="#iscompatibleviewport">isCompatibleViewport</a> returning false. It&apos;s expected that the tool will restart with target from the new viewport if compatible, and call <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/#exittool'>InteractiveTool.exitTool</a> otherwise.</p>
</blockquote>
<h2 class="h-accusnap">AccuSnap<a id="accusnap" class="heading-anchor" href="#accusnap"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/accusnap'>AccuSnap</a> is a aide for identifying elements and pickable decorations under the cursor. A tool can choose to enable locate, snapping, or both.</p>
<h3 class="h-snapping">Snapping<a id="snapping" class="heading-anchor" href="#snapping"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h3>
<p><img src=".././accusnap.png" alt="snapping example" title="Example of AccuSnap with snapping enabled"></p>
<p>Tools that override <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/ondatabuttondown'>InteractiveTool.onDataButtonDown</a> or <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/ondatabuttonup'>InteractiveTool.onDataButtonUp</a> and use <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/bebuttonevent/point'>BeButtonEvent.point</a> directly, in particular those that create new or modify existing elements, should call <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/accusnap/#enablesnap'>AccuSnap.enableSnap</a> with true to enable snapping. Snapping allows the user to identity locations of interest to them on existing elements or pickable decorations by choosing a <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/snapmode'>SnapMode</a> and snap divisor. Snapping is used to identify points, <em>not</em> elements.</p>
<blockquote>
<p>To be considered active, both tool and user must enable snapping; <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/accusnap/#issnapenabled'>AccuSnap.isSnapEnabled</a> and <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/accusnap/issnapenabledbyuser'>AccuSnap.isSnapEnabledByUser</a> must both return true. The user that disables snapping through AccuSnap is choosing to identify snap locatations using <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/tentativepoint'>TentativePoint</a> instead. The default <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/idletool'>IdleTool</a> behavior of a middle mouse button click is to perform a tentative snap.</p>
</blockquote>
<p><img src=".././tentative.png" alt="tentative example" title="Example showing Tentative snap to element"></p>
<blockquote>
<p>A tool with an understanding of connection points and how things fit together <em>should not</em> enable AccuSnap. For example, a tool to place a valve on a pipe knows to only choose pipe end points of a given diameter, it should not require the user to choose an appropriate snap point at the end of a correct pipe or try to influence AccuSnap to only generative <em>key points</em> it deems appropriate. This is case where <a href="#locate">locate</a> should be enabled instead.</p>
</blockquote>
<p>Example from a simple sketching tool that uses AccuSnap to create and show a linestring in dynamics:</p>
<pre class="no-line-numbers"><code class="language-typescript">  public readonly points: Point3d[] = [];

  public onDynamicFrame(ev: BeButtonEvent, context: DynamicsContext): void {
    if (this.points.length &lt; 1)
      return;

    const tmpPoints = this.points.slice(); // Create shallow copy of accepted points
    tmpPoints.push(ev.point.clone()); // Include current cursor location

    const builder = context.createSceneGraphicBuilder();
    builder.setSymbology(context.viewport.getContrastToBackgroundColor(), ColorDef.black, 1);
    builder.addLineString(tmpPoints);
    context.addGraphic(builder.finish()); // Show linestring in view
  }

  public async onDataButtonDown(ev: BeButtonEvent): Promise&lt;EventHandled&gt; {
    this.points.push(ev.point.clone()); // Accumulate accepted points, ev.point has been adjusted by AccuSnap and locks

    if (!this.isDynamicsStarted)
      this.beginDynamics(); // Start dynamics on first data button so that onDynamicFrame will be called

    return EventHandled.No;
  }

  public onPostInstall() {
    super.onPostInstall();
    IModelApp.accuSnap.enableSnap(true); // Enable AccuSnap so that linestring can be created by snapping to existing geometry
  }</code></pre>
<blockquote>
<p>PrimitiveTool has a button event filter that becomes active when snapping is enabled. The range of physical geometry created or modified by tools should always be fully contained within the bounds defined by <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/imodels/imodel/projectextents'>IModel.projectExtents</a>. The purpose of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/#isvalidlocation'>InteractiveTool.isValidLocation</a> is to reject button events that would result in geometry that exceeds the project extents. When isValidLocation returns false, the user is presented with an <em>invalid location</em> cursor and the button event is not sent to the tool. The default implementation of isValidLocation only checks that <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/bebuttonevent/point'>BeButtonEvent.point</a> is inside the project extents, tools should override isValidLocation to implement a more robust check based on the range of the geometry they create.</p>
</blockquote>
<h3 class="h-locate">Locate<a id="locate" class="heading-anchor" href="#locate"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h3>
<p><img src=".././autolocate.png" alt="locate example" title="Example of AccuSnap with locate enabled"></p>
<p>A tool that only needs to identify elements and does not use <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/bebuttonevent/point'>BeButtonEvent.point</a> should not enable snapping. Instead the tool should call <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/accusnap/#enablelocate'>AccuSnap.enableLocate</a> with true to begin locating elements as the cursor moves over them. Enabling locate for AccuSnap provides the user with feedback regarding the element under the cursor in the form of a tooltip. Element&apos;s will also glow to highlight when they are of the type the tool is looking for.</p>
<p>When either locate with AccuSnap is enabled, or the tool requests a new locate by calling <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/elementlocatemanager/#dolocate'>ElementLocateManager.doLocate</a> on a button event, <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/filterhit'>InteractiveTool.filterHit</a> will be called to give the tool an opportunity to accept or reject the element or pickable decoration identified by a supplied <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/hitdetail'>HitDetail</a>. When overriding filterHit and rejecting a hit, the tool should set <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/locatingelements/locateresponse/#reason'>LocateResponse.reason</a> to explain why the hit is being rejected; this message will be displayed on motion stop in a tooltip when an implementation for <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/notifications/notificationmanager/#_showtooltip'>NotificationManager._showToolTip</a> is provided.</p>
<p>A tool can also customize the tooltip for accepted elements in order to include tool specific details by overriding <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/gettooltip'>InteractiveTool.getToolTip</a>.</p>
<blockquote>
<p>Unlike snapping, only the tool needs to enable locate to make it active. By giving the user feedback about the element under the cursor <em>before</em> they click on it, tools are able to complete with less clicks as the need for an explicit accept/reject step after identifying the element through a button event is eliminated.</p>
</blockquote>
<p>In addition to enabling AccuSnap locate, the tool should set an appropriate view cursor as well as enable the display of the locate circle. A convenient helper method is provided to set up everything a tool needs to begin locating elements, <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/initlocateelements'>InteractiveTool.initLocateElements</a>.</p>
<p>Example from a simple tool that locates elements and makes them the current selection set:</p>
<pre class="no-line-numbers"><code class="language-typescript">  public async filterHit(hit: HitDetail, _out?: LocateResponse): Promise&lt;LocateFilterStatus&gt; {
    // Check that element is valid for the tool operation, ex. query backend to test class, etc.
    // For this example we&apos;ll just test the element&apos;s selected status.
    const isSelected = this.iModel.selectionSet.has(hit.sourceId);
    return isSelected ? LocateFilterStatus.Reject : LocateFilterStatus.Accept; // Reject element that is already selected
  }

  public async onDataButtonDown(ev: BeButtonEvent): Promise&lt;EventHandled&gt; {
    const hit = await IModelApp.locateManager.doLocate(new LocateResponse(), true, ev.point, ev.viewport, ev.inputSource);
    if (hit !== undefined)
      this.iModel.selectionSet.replace(hit.sourceId); // Replace current selection set with accepted element

    return EventHandled.No;
  }

  public onPostInstall() {
    super.onPostInstall();
    this.initLocateElements(); // Enable AccuSnap locate, set view cursor, add CoordinateLockOverrides to disable unwanted pre-locate point adjustments...
  }</code></pre>
<h2 class="h-accudraw">AccuDraw<a id="accudraw" class="heading-anchor" href="#accudraw"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p><img src=".././accudraw.png" alt="AccuDraw example" title="Example of AccuDraw using axis lock to constrain snapped point"></p>
<p><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/accudraw/accudrawhintbuilder'>AccuDrawHintBuilder</a> is an aide for entering coordinate data. By using <em>shortcuts</em> to position and orient the AccuDraw compass, locking a direction, or entering distance and angle values, the user is able to accurately enter points. AccuDraw isn&apos;t strictly controlled by the user however, the tool is also able to provide additional context to AccuDraw in the form of <em>hints</em> to make the tool easier to use.</p>
<p>Some examples of AccuDraw tool hints:</p>
<ul>
<li>Send AccuDraw hint to use polar mode when defining a sweep angle.</li>
<li>Send AccuDraw hint to set origin to opposite end point of line segment being modified and orient to segment direction, a new line length can be now easily specified.</li>
</ul>
<p>Upon installing a new Primitive tool as the active tool, AccuDraw&apos;s default state is initialized to <em>inactive</em>. AccuDraw will upgrade it&apos;s internal state to <em>active</em> automatically if the tool calls <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/begindynamics'>InteractiveTool.beginDynamics</a>. Tools that won&apos;t start dynamics (might only use view decorations) but still wish to support AccuDraw can explicitly enable it using <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/accudraw/accudrawhintbuilder/#activate'>AccuDrawHintBuilder.activate</a> or <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/accudraw/accudrawhintbuilder/sendhints'>AccuDrawHintBuilder.sendHints</a>. Conversely, tools that show dynamics, but do not want AccuDraw, are required to explicitly disable it by calling <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/accudraw/accudrawhintbuilder/#deactivate'>AccuDrawHintBuilder.deactivate</a>.</p>
<blockquote>
<p>Using the example of a tool that places a valve on a pipe again, the tool doesn&apos;t require the user to orient the valve on the closest pipe end point, it can get this information from the pipe element. As AccuDraw doesn&apos;t need to be enabled by the tool in this situation, but the tool does wish to preview the valve placment using dynamics, it should disable AccuDraw&apos;s automatic activation.</p>
</blockquote>
<p><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/accudraw/accudrawhintbuilder'>AccuDrawHintBuilder</a> is a helper class tools can use to send hints to AccuDraw. A tool will typically send hints from <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/interactivetool/ondatabuttondown'>InteractiveTool.onDataButtonDown</a>, the hints are often accompanied by new tool prompts explaining what input is expected next.</p>
<blockquote>
<p>Tools that enable AccuDraw, either through automatic or explicit activation, should still not rely on AccuDraw or it&apos;s hints for point adjustment. The user may choose to disable AccuDraw completely, set a preference to ignore tool hints in favor of manually controlling the AccuDraw compass, or use shortcuts to override the tool&apos;s hints. If for example a tool requires the input point be projected to a particular plane in the view, even after enabling AccuDraw and sending hints to set the compass origin and rotation to define the plane, it must still correct <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-frontend/tools/bebuttonevent/point'>BeButtonEvent.point</a> to ensure it lies on the plane for the reasons previously mentioned.</p>
</blockquote>
<p>Example from a simple sketching tool that uses AccuDrawHintBuilder to facilitate drawing orthogonal segments:</p>
<pre class="no-line-numbers"><code class="language-typescript">  public readonly points: Point3d[] = [];

  public setupAndPromptForNextAction(): void {
    // NOTE: Tool should call IModelApp.notifications.outputPromptByKey or IModelApp.notifications.outputPrompt to tell user what to do.
    IModelApp.accuSnap.enableSnap(true); // Enable AccuSnap so that linestring can be created by snapping to existing geometry

    if (0 === this.points.length)
      return;

    const hints = new AccuDrawHintBuilder();
    hints.enableSmartRotation = true; // Set initial AccuDraw orientation based on snapped geometry (ex. sketch on face of a solid)

    if (this.points.length &gt; 1 &amp;&amp; !(this.points[this.points.length - 1].isAlmostEqual(this.points[this.points.length - 2])))
      hints.setXAxis(Vector3d.createStartEnd(this.points[this.points.length - 2], this.points[this.points.length - 1])); // Align AccuDraw with last accepted segment

    hints.setOrigin(this.points[this.points.length - 1]); // Set compass origin to last accepted point.
    hints.sendHints();
  }

  public onDynamicFrame(ev: BeButtonEvent, context: DynamicsContext): void {
    if (this.points.length &lt; 1)
      return;

    const tmpPoints = this.points.slice(); // Create shallow copy of accepted points
    tmpPoints.push(ev.point.clone()); // Include current cursor location

    const builder = context.createSceneGraphicBuilder();
    builder.setSymbology(context.viewport.getContrastToBackgroundColor(), ColorDef.black, 1);
    builder.addLineString(tmpPoints);
    context.addGraphic(builder.finish()); // Show linestring in view
  }

  public async onDataButtonDown(ev: BeButtonEvent): Promise&lt;EventHandled&gt; {
    this.points.push(ev.point.clone()); // Accumulate accepted points, ev.point has been adjusted by AccuSnap and locks
    this.setupAndPromptForNextAction();

    if (!this.isDynamicsStarted)
      this.beginDynamics(); // Start dynamics on first data button so that onDynamicFrame will be called

    return EventHandled.No;
  }

  public async onResetButtonUp(_ev: BeButtonEvent): Promise&lt;EventHandled&gt; {
    this.onReinitialize(); // Complete current linestring
    return EventHandled.No;
  }

  public onPostInstall() { super.onPostInstall(); this.setupAndPromptForNextAction(); }</code></pre>

            <p class='last-updated'>Last Updated:
                <span class='date-updated'>20 September, 2019</span>
            </p>
            <div id="imodeljs-github-comments">
            </div>
            
            <script>
              $(document).ready(function () {
                function initializeComments(repo) {
                  var s = document.createElement('script');
                  s.src = "https://imodeljs.github.io/iModelJs-docs-output//scripts/utterances/client.js";
                  s.setAttribute('repo', repo);
                  s.setAttribute('issue-term', 'title');
                  s.setAttribute('crossorigin', 'anonymous');
                  s.setAttribute('theme', 'github-light');
                  s.async = true;
            
                  document.getElementById("imodeljs-github-comments").appendChild(s);
                }
            
                var shouldShow = ldclient.variation(featureFlags.GithubIssuesFeedback);
            
                // shouldShow is undefined when ldclient has not emitted 'ready'.
                if (shouldShow === undefined) {
                  ldclient.on('ready', function () {
                    var gitIssueFlag = ldclient.variation(featureFlags.GithubIssuesFeedback);
                    var gitRepo = ldclient.variation(featureFlags.GitRepo);
                    if (gitIssueFlag) {
                      initializeComments(gitRepo);
                    }
                  });
                }
                else if (shouldShow) {
                  var gitRepo = ldclient.variation(featureFlags.GitRepo);
                  initializeComments(gitRepo);
                }
              });
            </script>
            
            <script type="text/javascript">
            
            </script>        </article>
    </div>
    <div class="toc-overlay"></div>
    <div id='inner-table-of-contents'>
       <!-- <div id='sticky-container' style="top: 76px; position: fixed;">
  <h4 class='heading'>On this page</h4>
    <div id="overview-container" class="clusterize-scroll">
      <ul id='nav' class='right-nav nav flex-column clusterize-content'>
              <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#running-the-tool">Running the tool</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#iscompatibleviewport">isCompatibleViewport</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#oninstall">onInstall</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#onpostinstall">onPostInstall</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#onrestarttool">onRestartTool</a>
    </li>
       <li class='nav-item item '>
            <a data-target="#inner-nav-accusnap" class='title' href="#accusnap"/>
            <b class='dropdown-menu-title menu-text'>AccuSnap</b>
            <i class='nav-list-dropdown icon'></i>
            </a>
            <ul id="inner-nav-accusnap" class='inner-nav'>
                    <li class='nav-item item '>
                            <a class='title solo-title menu-text' href="#snapping">Snapping</a>
                    </li>
                    <li class='nav-item item '>
                            <a class='title solo-title menu-text' href="#locate">Locate</a>
                    </li>
            </ul>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#accudraw">AccuDraw</a>
    </li>
 
      </ul>
    </div>
  </div>

 -->
    </div>
</div>

<!-- Footer -->
<footer class="page-footer font-small mdb-color pt-1 pb-3">
  <!-- Footer Links Container -->
  <div class="container text-center text-md-left">

    <!-- Grid row -->
    <div class="row d-flex align-items-center mt-2">

      <!-- Grid column -->
      <div class="col-md-7 col-lg-8 align-top d-none d-md-block">

        <a href="https://imodeljs.github.io/iModelJs-docs-output//" class="navbar-brand">
          <img id="site-logo" class="site-logo" style="zoom:75%;"
            src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-logo.svg" />
        </a>
        <small style="color: white; margin-right: 7px;"> powered by </small>
        <a href="https://www.bentley.com">
          <img href="https://www.bentley.com" id="sponsored-by-logo" class="sponsored-by-logo"
            style="zoom:75%; width: 162px; height: 37px;"
            src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/bentley.svg" />
        </a>
      </div>
      <!-- Grid column -->

      <!-- Grid column -->
      <div class="col-md-5 col-lg-4 ml-lg-0">

        <!-- Social buttons -->
        <div class="text-center text-md-right">
          <ul class="list-unstyled list-inline">
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://twitter.com/imodeljs" target="_blank">
                <i class="fa fa-twitter"></i>
              </a>
            </li>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://github.com/imodeljs" target="_blank">
                <i class="fa fa-github"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://stackoverflow.com/tags/imodeljs"
                target="_blank">
                <i class="fa fa-stack-overflow"></i>
              </a>
            </li>
          </ul>
        </div>

      </div>
      <!-- Grid column -->

    </div>
    <!-- Grid row -->

  </div>
  <!-- Footer Links Container -->

</footer>
<!-- Footer -->

</div>
<a href="javascript:" id="return-to-top"><i class="icon icon-chevron-up"></i></a>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/bundle.js"></script>
</body>

</html>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/monaco-editor/min/vs/loader.js"></script>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/ts-playground.js"></script>

<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Events - iModel.js</title>
    <meta name="BeMetalsmithVersion" content="v3.3.10">
    <meta name="og:title" content="Events - iModel.js">
    <meta name="twitter:title" content="Events - iModel.js">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/bundle.css">

    <!-- bootstrap -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!-- fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"> 
    
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/devRegistration.css"> 
    
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/landingPage.css">  
        <link rel='shortcut icon' type='image/x-icon' href='https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs_16.png' /> 
        <meta property="og:description" content="Create Immersive Connections with your Infrastructure Digital Twin."><meta property="og:url" content="imodeljs.org"><meta name="twitter:card" content="summary_large_image">
        <meta property="og:image" content="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/twitter-share.png">
        <meta />
</head>

<body data-site-root=https://imodeljs.github.io/iModelJs-docs-output// class='layout-index '>
    <span id="contentLoader">
        <p>Woah! This page has a great deal of content... Give us a second to load it.</p>
    </span>
    <span id="contentLoaderBackground"></span>
    <div id="flex-wrapper">



        <header id="main-header">
            <div class='nav-header-container'>
                <nav class="navbar nav-main-header navbar-expand-md fixed-top navbar-light pb-0">
                    <a href="https://imodeljs.github.io/iModelJs-docs-output//" class="navbar-brand">
                            <img id="site-logo" class="site-logo" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-logo.svg" /> 
                            <img id="site-logo-small" class="site-logo-small" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-icon.svg" style="display:none;"/> 
                    </a>
                    <button class="navbar-toggler no-user-select mr-auto" type="button" data-toggle="collapse" data-target="#navbar5">
                        <span class="navbar-toggler-header"></span>
                    </button>
                    <ul class="navbar-nav ml-auto pr-0 nav-search">
                        <span class='search-bar'>
                          <li>
                            <div id='search-container'>
                            </div>
                          </li>
                          <script>
                            (function() {
                              var cx = '018053174497532353467:v_gnrjjlqwc';
                              var gcse = document.createElement('script');
                              gcse.type = 'text/javascript';
                              gcse.async = true;
                              gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                              var s = document.getElementsByTagName('script')[0];
                              s.parentNode.insertBefore(gcse, s);
                            })();
                          </script>
                          <gcse:searchresults-only gname="sitesearch" resultSetSize="7"></gcse:search>
                        </span>
                    </ul>
                    <div class="navbar-collapse collapse justify-content-stretch" id="navbar5">
                        <ul class="navbar-nav mb-0" id="doc-site-tabs">
                                <li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//getting-started">Getting Started</a></li><li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//bis">BIS</a></li><li class="nav-item active"><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//learning">Learning</a></li><li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//reference">API Reference</a></li><li class="nav-item change-history-tab "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//changehistory">v1.9.0</a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
<div id='main-wrapper'>
    <nav id='sidebar'>
        <div id='table-of-contents' class="custom-scrollbar">
            <div id="dismiss">
                <i id="dismiss-arrow" class="icon icon-chevron-left no-user-select"></i>
            </div>
            <hr id="dismiss-hr" class='sm-only'>
            <ul id='main-navigation-list'>
                <html><head></head><body><h3 id="the imodel.js library"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/" class="table-of-contents-link">The iModel.js Library</a></h3>
    <ul>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/frontend/" class="table-of-contents-link">Frontend</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/backend/" class="table-of-contents-link">Backend</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/common/" class="table-of-contents-link">Common</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/geometry/" class="table-of-contents-link">Geometry</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/presentation/" class="table-of-contents-link">Presentation</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/ui/" class="table-of-contents-link">UI</a></li>
    </ul>
    <hr>
    <p>&#xA0;</p>
    <h3 id="helpful links">Helpful links</h3>
    <ul>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/ecsql" class="table-of-contents-link">ECSQL</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/imodelhub/" class="table-of-contents-link">iModelHub</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/wireformat" class="table-of-contents-link">Wire Format</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/faq" class="table-of-contents-link">Frequently Asked Questions</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/guidelines/" class="table-of-contents-link">Guidelines and Tips</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/glossary" class="table-of-contents-link">Glossary</a></li>
    </ul>
    </body></html>
            </ul>
        </div>
    </nav>    <div class='documentation-main'>
        <article id="main" class="main-content">
            <button type="button" id="sidebarCollapse" class="no-user-select"> <i class="bread-crumb-label bread-crumb-expand-leftnav icon icon-chevron-right no-user-select" id="expand-leftnav"></i></button><div class='bread-crumb-label'><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/">Learning</a> > <a href="https://imodeljs.github.io/iModelJs-docs-output//learning/imodelhub/">imodelhub</a> > Events</div>
            <div class="edit-link"><a href="https://github.com/imodeljs/imodeljs/tree/master/docs/learning/iModelHub/Events.md">Edit this page</a></div>
            <h1 id="events">Events</h1>
<p>iModelHub sends <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/imodelhubevent'>IModelHubEvent</a>s for operations that occur on a particular iModel.</p>
<p>To receive events, the user has to:</p>
<ol>
<li><a href="#creating-events-subscription">Subscribe to events</a> from a single iModel, specifying <a href="#event-types">types of events</a> they want to receive.</li>
<li>Get an <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventsas'>EventSAS</a> token, that is used to authenticate to Events service. See <a href="#getting-events">getting events</a>.</li>
<li>Send a request to get and delete the first event from that subscription&apos;s queue. See <a href="#getting-events">getting events</a>.</li>
</ol>
<p>Instead of repeating steps 2 and 3, it&apos;s possible to <a href="#creating-events-listener">create a listener</a> that continuously receives events from a subscription.</p>
<h2 class="h-event-types">Event Types<a id="event-types" class="heading-anchor" href="#event-types"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>When a user <a href="#creating-events-subscription">subscribes to events</a>, they have to provide <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventtype'>EventType</a>s of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/imodelhubevent'>IModelHubEvent</a>s they want to receive. iModelHub sends these events:</p>
<table class="table table-responsive"><tbody><tr>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>AllCodesDeletedEvent</td>
<td>All HubCodes for a Briefcase are deleted.</td>
</tr>
<tr>
<td>AllLocksDeletedEvent</td>
<td>All Locks for a Briefcase are deleted.</td>
</tr>
<tr>
<td>BriefcaseDeletedEvent</td>
<td>A Briefcase was deleted.</td>
</tr>
<tr>
<td><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/changesetpostpushevent'>ChangeSetPostPushEvent</a></td>
<td>A <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/changeset'>ChangeSet</a> was successfully pushed.</td>
</tr>
<tr>
<td><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/changesetprepushevent'>ChangeSetPrePushEvent</a></td>
<td>A <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/changeset'>ChangeSet</a> push has started.</td>
</tr>
<tr>
<td>CodeEvent</td>
<td>One or more HubCodes were updated.</td>
</tr>
<tr>
<td><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/imodeldeletedevent'>IModelDeletedEvent</a></td>
<td>An iModel was deleted.</td>
</tr>
<tr>
<td>LockEvent</td>
<td>One or more Locks were updated.</td>
</tr>
<tr>
<td><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/versionevent'>VersionEvent</a></td>
<td>A new named <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/version'>Version</a> was created.</td>
</tr>
</tbody></table><blockquote>
<p>CodeEvent and LockEvent includes every updated HubCode or Lock value, so it tends to be quite chatty. It&apos;s recommended to not subscribe to these events, unless they are necessary for your workflow.</p>
</blockquote>
<h2 class="h-creating-events-subscription">Creating Events Subscription<a id="creating-events-subscription" class="heading-anchor" href="#creating-events-subscription"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>To receive <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/imodelhubevent'>IModelHubEvent</a>s, user has to create an <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventsubscription'>EventSubscription</a>. Creating a subscription requires the user to specify an array of <a href="#event-types">event types</a> they want to receive.</p>
<p>Creating subscription requires user to have an <a href='https://imodeljs.github.io/iModelJs-docs-output//./learning/common/accesstoken'>access token</a> and have a valid <a href='https://imodeljs.github.io/iModelJs-docs-output//./learning/imodelhub/imodels/getimodel'>iModel id</a>.</p>
<p>Example:</p>
<pre class="no-line-numbers"><code class="language-typescript">  const subscription: EventSubscription = await imodelHubClient.events
    .subscriptions.create(authorizedRequestContext, imodelId, [&quot;ChangeSetPostPushEvent&quot;, &quot;VersionEvent&quot;]);
</code></pre>
<p>After creating the subscription, <code>subscription.wsgId</code> can be used when subscription id is requested.</p>
<p>Each subscription contains its own queue of events. Subscriptions expire after an hour of inactivity.</p>
<h2 class="h-getting-events">Getting events<a id="getting-events" class="heading-anchor" href="#getting-events"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>First user has to get an <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventsas'>EventSAS</a> token.</p>
<pre class="no-line-numbers"><code class="language-typescript">  const sasToken: EventSAS = await imodelHubClient.events.getSASToken(authorizedRequestContext, imodelId);
</code></pre>
<p>Then they can get the first event from their subscription&apos;s queue. This will immediately delete the event from the queue.</p>
<pre class="no-line-numbers"><code class="language-typescript">  const event: IModelHubEvent | undefined = await imodelHubClient.events
    .getEvent(requestContext, sasToken.sasToken!, sasToken.baseAddress!, subscription.wsgId, 60);
</code></pre>
<p>If <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventhandler/getevent'>EventHandler.getEvent</a> is called with a timeout duration specified, this request will perform long polling. If this request didn&apos;t find an event on the queue, it would wait until one is available or the timeout expires. This way the event reaches the client faster and less requests are sent between the client and the service.</p>
<p><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventhandler/getevent'>EventHandler.getEvent</a> can fail because <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventsas'>EventSAS</a> has expired. It can also return undefined if no events have been found.</p>
<h2 class="h-creating-events-listener">Creating Events Listener<a id="creating-events-listener" class="heading-anchor" href="#creating-events-listener"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p><a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventhandler/createlistener'>EventHandler.createListener</a> can be used to handle repeated calls to <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventhandler/getevent'>EventHandler.getEvent</a> and <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventhandler/getsastoken'>EventHandler.getSASToken</a>.</p>
<p>Authentication callback example, similar to <a href='https://imodeljs.github.io/iModelJs-docs-output//./learning/common/accesstoken'>getting access token</a>. AuthorizationToken could be retrieved from credentials stored somewhere else or refreshed before it expires.</p>
<pre class="no-line-numbers"><code class="language-typescript">async function authenticate(): Promise&lt;AccessToken&gt; {
  const requestContext = new ClientRequestContext();
  const authorizationToken: AuthorizationToken = await authorizationClient
    .getToken(requestContext, userCredentials);
  return imodelHubClient.getAccessToken(requestContext, authorizationToken);
}
</code></pre>
<p>Listener callback example. This callback just logs the type of the <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/imodelhubevent'>IModelHubEvent</a> received.</p>
<pre class="no-line-numbers"><code class="language-typescript">function processEvent(event: IModelHubEvent): void {
  Logger.logInfo(&quot;example&quot;, `Event of the type ${typeof event} received.`);
}
</code></pre>
<p>To create the listener itself, user has to have an <a href='https://imodeljs.github.io/iModelJs-docs-output//./learning/imodelhub/imodels/getimodel'>iModel id</a> and have an <a href="#creating-events-subscription">event subscription</a>.</p>
<pre class="no-line-numbers"><code class="language-typescript">  const deleteCallback = await imodelHubClient.events  // tslint:disable-line:await-promise
    .createListener(requestContext, authenticate, subscription.wsgId, imodelId, processEvent);
</code></pre>
<p>Deleting the listener after it&apos;s no longer necessary is just calling the callback received when creating it.</p>
<pre class="no-line-numbers"><code class="language-typescript">  deleteCallback();
</code></pre>
<p>Event listener will work in the background, continuously getting events for a specific <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventsubscription'>EventSubscription</a>. Once an <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/imodelhubevent'>IModelHubEvent</a> is received, all registered listener callbacks for that subscription are called. If <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventsas'>EventSAS</a> expires, <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/imodelhubclient/eventhandler/getsastoken'>EventHandler.getSASToken</a> will be called automatically. If <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-clients/authentication/accesstoken'>AccessToken</a> expires, authentication callback will be called to refresh that token.</p>
<p>Event listener will stop if there&apos;s an error getting events for that subscription or when all listeners for it are deleted. In the latter case, any outstanding long polling requests could still complete.</p>
<p>Listeners for the same subscription will only make a single event request at a time. Listeners for different subscriptions work independently.</p>

            <p class='last-updated'>Last Updated:
                <span class='date-updated'>19 December, 2019</span>
            </p>
            <div id="imodeljs-github-comments">
            </div>
            
            <script>
              $(document).ready(function () {
                function initializeComments(repo) {
                  var s = document.createElement('script');
                  s.src = "https://imodeljs.github.io/iModelJs-docs-output//scripts/utterances/client.js";
                  s.setAttribute('repo', repo);
                  s.setAttribute('issue-term', 'title');
                  s.setAttribute('crossorigin', 'anonymous');
                  s.setAttribute('theme', 'github-light');
                  s.async = true;
            
                  document.getElementById("imodeljs-github-comments").appendChild(s);
                }
            
                var shouldShow = ldclient.variation(featureFlags.GithubIssuesFeedback);
            
                // shouldShow is undefined when ldclient has not emitted 'ready'.
                if (shouldShow === undefined) {
                  ldclient.on('ready', function () {
                    var gitIssueFlag = ldclient.variation(featureFlags.GithubIssuesFeedback);
                    var gitRepo = ldclient.variation(featureFlags.GitRepo);
                    if (gitIssueFlag) {
                      initializeComments(gitRepo);
                    }
                  });
                }
                else if (shouldShow) {
                  var gitRepo = ldclient.variation(featureFlags.GitRepo);
                  initializeComments(gitRepo);
                }
              });
            </script>
            
            <script type="text/javascript">
            
            </script>        </article>
    </div>
    <div class="toc-overlay"></div>
    <div id='inner-table-of-contents'>
       <!-- <div id='sticky-container' style="top: 76px; position: fixed;">
  <h4 class='heading'>On this page</h4>
    <div id="overview-container" class="clusterize-scroll">
      <ul id='nav' class='right-nav nav flex-column clusterize-content'>
              <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#event-types">Event Types</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#creating-events-subscription">Creating Events Subscription</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#getting-events">Getting events</a>
    </li>
       <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#creating-events-listener">Creating Events Listener</a>
    </li>
 
      </ul>
    </div>
  </div>

 -->
    </div>
</div>

<!-- Footer -->
<footer class="page-footer font-small mdb-color pt-1 pb-3">
  <!-- Footer Links Container -->
  <div class="container text-center text-md-left">

    <!-- Grid row -->
    <div class="row d-flex align-items-center mt-2">

      <!-- Grid column -->
      <div class="col-md-7 col-lg-8 align-top d-none d-md-block">

        <a href="https://imodeljs.github.io/iModelJs-docs-output//" class="navbar-brand">
          <img id="site-logo" class="site-logo" style="zoom:75%;"
            src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-logo.svg" />
        </a>
        <small style="color: white; margin-right: 7px;"> powered by </small>
        <a href="https://www.bentley.com">
          <img href="https://www.bentley.com" id="sponsored-by-logo" class="sponsored-by-logo"
            style="zoom:75%; width: 162px; height: 37px;"
            src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/bentley.svg" />
        </a>
      </div>
      <!-- Grid column -->

      <!-- TOS/Legals footer placeholder -->
      <div id="GlobalFooter"></div>

      <!-- Grid column -->
      <div class="col-md-5 col-lg-4 ml-lg-0">

        <!-- Social buttons -->
        <div class="text-center text-md-right">
          <ul class="list-unstyled list-inline">
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://twitter.com/imodeljs" target="_blank">
                <i class="fa fa-twitter"></i>
              </a>
            </li>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://github.com/imodeljs" target="_blank">
                <i class="fa fa-github"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://stackoverflow.com/tags/imodeljs"
                target="_blank">
                <i class="fa fa-stack-overflow"></i>
              </a>
            </li>
          </ul>
        </div>

      </div>
      <!-- Grid column -->

    </div>
    <!-- Grid row -->

  </div>
  <!-- Footer Links Container -->

</footer>
<!-- Footer -->

</div>
<a href="javascript:" id="return-to-top"><i class="icon icon-chevron-up"></i></a>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/bundle.js"></script>
</body>

</html>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/monaco-editor/min/vs/loader.js"></script>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/ts-playground.js"></script>

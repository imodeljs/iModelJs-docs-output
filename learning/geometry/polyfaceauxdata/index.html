<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Polyface Analytical Data Visualization - iModel.js</title>
    <meta name="og:title" content="Polyface Analytical Data Visualization - iModel.js">
    <meta name="twitter:title" content="Polyface Analytical Data Visualization - iModel.js">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/bundle.css">

    <!-- bootstrap -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!-- fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"> 
    
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/devRegistration.css"> 
    
    <link rel="stylesheet" type="text/css" href="https://imodeljs.github.io/iModelJs-docs-output//styles/landingPage.css">  
        <link rel='shortcut icon' type='image/x-icon' href='https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs_16.png' /> 
        <meta property="og:description" content="Create Immersive Connections with your Infrastructure Digital Twin."><meta property="og:url" content="imodeljs.org"><meta name="twitter:card" content="summary_large_image">
        <meta property="og:image" content="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/twitter-share.png">
        <meta />
</head>

<body data-site-root=https://imodeljs.github.io/iModelJs-docs-output// class='layout-index '>
    <span id="contentLoader">
        <p>Woah! This page has a great deal of content... Give us a second to load it.</p>
    </span>
    <span id="contentLoaderBackground"></span>
    <div id="flex-wrapper">



        <header id="main-header">
            <div class='nav-header-container'>
                <nav class="navbar nav-main-header navbar-expand-md fixed-top navbar-light pb-0">
                    <a href="https://imodeljs.github.io/iModelJs-docs-output//" class="navbar-brand">
                            <img id="site-logo" class="site-logo" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-logo.svg" /> 
                            <img id="site-logo-small" class="site-logo-small" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-icon.svg" style="display:none;"/> 
                    </a>
                    <button class="navbar-toggler no-user-select mr-auto" type="button" data-toggle="collapse" data-target="#navbar5">
                        <span class="navbar-toggler-header"></span>
                    </button>
                    <ul class="navbar-nav ml-auto pr-0 nav-search">
                        <span class='search-bar'>
                          <li>
                            <div id='search-container'>
                            </div>
                          </li>
                          <script>
                            (function() {
                              var cx = '018053174497532353467:v_gnrjjlqwc';
                              var gcse = document.createElement('script');
                              gcse.type = 'text/javascript';
                              gcse.async = true;
                              gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                              var s = document.getElementsByTagName('script')[0];
                              s.parentNode.insertBefore(gcse, s);
                            })();
                          </script>
                          <gcse:searchresults-only gname="sitesearch" resultSetSize="7"></gcse:search>
                        </span>
                    </ul>
                    <div class="navbar-collapse collapse justify-content-stretch" id="navbar5">
                        <ul class="navbar-nav mb-0" id="doc-site-tabs">
                                <li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//getting-started">Getting Started</a></li><li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//bis">BIS</a></li><li class="nav-item active"><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//learning">Learning</a></li><li class="nav-item "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//reference">API Reference</a></li><li class="nav-item change-history-tab "><a class="nav-link" href="https://imodeljs.github.io/iModelJs-docs-output//changehistory">v0.187.0</a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
<div id='main-wrapper'>
    <nav id='sidebar'>
        <div id='table-of-contents' class="custom-scrollbar">
            <div id="dismiss">
                <i id="dismiss-arrow" class="icon icon-chevron-left no-user-select"></i>
            </div>
            <hr id="dismiss-hr" class='sm-only'>
            <ul id='main-navigation-list'>
                <html><head></head><body><h3 id="the imodel.js library"><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/" class="table-of-contents-link">The iModel.js Library</a></h3>
    <ul>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/frontend/" class="table-of-contents-link">Frontend</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/backend/" class="table-of-contents-link">Backend</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/common/" class="table-of-contents-link">Common</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/geometry/" class="table-of-contents-link">Geometry</a></li>
    </ul>
    <hr>
    <p>&#xA0;</p>
    <h3 id="helpful links">Helpful links</h3>
    <ul>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/ecsql" class="table-of-contents-link">ECSQL</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/imodelhub/" class="table-of-contents-link">iModelHub</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/wireformat" class="table-of-contents-link">Wire Format</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/faq" class="table-of-contents-link">Frequently Asked Questions</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/guidelines/" class="table-of-contents-link">Guidelines and Tips</a></li>
    <li><a href="https://imodeljs.github.io/iModelJs-docs-output//./learning/glossary" class="table-of-contents-link">iModel.js Glossary</a></li>
    </ul>
    </body></html>
            </ul>
        </div>
    </nav>    <div class='documentation-main'>
        <article id="main" class="main-content">
            <button type="button" id="sidebarCollapse" class="no-user-select"> <i class="bread-crumb-label bread-crumb-expand-leftnav icon icon-chevron-right no-user-select" id="expand-leftnav"></i></button><div class='bread-crumb-label'><a href="https://imodeljs.github.io/iModelJs-docs-output//learning/">Learning</a> > <a href="https://imodeljs.github.io/iModelJs-docs-output//learning/geometry/">geometry</a> > PolyfaceAuxData</div>
            <div class="edit-link"><a href="https://github.com/imodeljs/imodeljs/tree/master/docs/core/learning/geometry/PolyfaceAuxData.md">Edit this page</a></div>
            <h1 id="polyface analytical data visualization">Polyface Analytical Data Visualization</h1>
<p>The <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyfaceauxdata'>PolyfaceAuxData</a> structure contains one or more analytical data channels for each vertex of a <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyface'>Polyface</a>.  Typically a <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyface'>Polyface</a> will contain only vertex data required for its basic display, the vertex position, normal and possibly texture parameter.  The <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyfaceauxdata'>PolyfaceAuxData</a> structure contains supplemental data that is generally computed in an analysis program or extracted from an external data source.  This can be scalar data used to overide the vertex colors through <em>Thematic Colorization</em> or XYZ data used to deform the mesh by adjusting the vertex postions. The figure below represents a cantilever beam under a single point load.  The stress is represented through thematic colorization and the deflection is also displayed (exaggerated 100X by applying <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/rendering/analysisstyle'>AnalysisStyle</a> with displacementScale: 100.</p>
<p><img data-gifffer=".././figs/PolyfaceAuxData/Cantilever.gif" alt="&gt;"></p>
<p>Analytical Data Channels.
-</p>
<p>The <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyfaceauxdata'>PolyfaceAuxData</a> structure contains an array of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/auxchannel'>AuxChannel</a> structures that may each represent a separate quantity (temperature, stress, displacement etc.).  A channel will include one or more input values and a set of vertex values for each input value.  If more than one input value is included then it is possible to animate the visualization as the input changes.  The input would typically be either elapsed time or an external input such as load.  Each input channel is independent and only a single channel of a type (scalar, displacement or normal) may be displayed at a time.</p>
<p>Thematic Colorization
-</p>
<p>Visualization of scalar vertex data is achieved by using the values to map into a color gradient. The gradients can be controlled through the Gradient.ThematicSettings member of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/rendering/analysisstyle'>AnalysisStyle</a>.</p>
<p>Display Styles and Analysis Style.
  -</p>
<p>In iModel.js <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/views/displaystylesettings'>DisplayStyleSettings</a> contains a group of display settings.  A single <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/views/displaystylesettings'>DisplayStyleSettings</a> can be shared by on or more views.  The <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/rendering/analysisstyle'>AnalysisStyle</a> member of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/views/displaystylesettings'>DisplayStyleSettings</a> contains settings that control the display of <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyfaceauxdata'>PolyfaceAuxData</a>.  An <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/rendering/analysisstyle'>AnalysisStyle</a> may include:</p>
<ul>
<li>A single displacement channel. A displacementScale may be included to exaggerate or attenuate the displacement.</li>
<li>A single scalar channel, the scalar channel range and the thematic gradient to display the scalar data (<code>Gradient.ThematicSettings</code>).  In the images below the same mesh is displayed with two different <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/rendering/analysisstyle'>AnalysisStyle</a>s.</li>
</ul>
<hr>
<pre><code> Scalar Height with Sea-Mountain Gradient                   Scalar Slope with Blue-Red Gradient</code></pre><p><img data-gifffer=".././figs/PolyfaceAuxData/RadialWaveHeight.gif" alt="&gt;"> <img data-gifffer=".././figs/PolyfaceAuxData/RadialWaveSlope.gif" alt="&gt;"></p>
<h2 class="h-example">Example<a id="example" class="heading-anchor" href="#example"><span><i class="fa fa-link fa-rotate-90"></i></span></a></h2>
<p>An example creating a fictitious analytical mesh is included in the &quot;analysis-importer&quot; test application.  The application begins by creating the flat rectangular <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyface'>Polyface</a> with 100 rows and columns...</p>
<pre class="no-line-numbers"><code class="language-typescript">    const options = StrokeOptions.createForFacets();
    options.shouldTriangulate = true;
    const builder = PolyfaceBuilder.create(options);
    const nDimensions = 100;
    const spacing = 1.0;

    /** Create a simple flat mesh with 10,000 points (100x100) */
    for (let iRow = 0; iRow &lt; nDimensions - 1; iRow++) {
        for (let iColumn = 0; iColumn &lt; nDimensions - 1; iColumn++) {
            const quad = [Point3d.create(iRow * spacing, iColumn * spacing, 0.0),
            Point3d.create((iRow + 1) * spacing, iColumn * spacing, 0.0),
            Point3d.create((iRow + 1) * spacing, (iColumn + 1) * spacing, 0.0),
            Point3d.create(iRow * spacing, (iColumn + 1) * spacing)];
            builder.addQuadFacet(quad);
        }
    }
`</code></pre>
<p>Once the mesh is created the scalar and displacement data is created as number arrays.  For the purpose of this example we create a zero channel so that the initial state of the mesh has no displacement and zero scalar values and then produce a scalar channels representing the displacement with a radial wave super imposed on the mesh as well as scalar channels that represent the height and slope of the mesh.  Note that a single value is pushed for scalar channel data, while the displacement requires 3 values.</p>
<pre class="no-line-numbers"><code class="language-typescript">    const zeroScalarData = [],
        zeroDisplacementData = [],
        radialHeightData = [],
        radialSlopeData = [],
    const radius = nDimensions * spacing / 2.0;
    const center = new Point3d(radius, radius, 0.0);
    const maxHeight = radius / 4.0;
    const auxChannels = [];

    /** Create a radial wave - start and return to zero  */
    for (let i = 0; i &lt; polyface.data.point.length; i++) {
        const angle = Angle.pi2Radians * polyface.data.point.distanceIndexToPoint(i, center) / radius;
        const height = maxHeight * Math.sin(angle);
        const slope = Math.abs(Math.cos(angle));

        zeroScalarData.push(0.0);
        zeroDisplacementData.push(0.0);
        zeroDisplacementData.push(0.0);
        zeroDisplacementData.push(0.0);

        radialHeightData.push(height);
        radialSlopeData.push(slope);
        radialDisplacementData.push(0.0);
        radialDisplacementData.push(0.0);
        radialDisplacementData.push(height);
    }</code></pre>
<p>Next we take the channel data and create an array <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/auxchanneldata'>AuxChannelData</a> entries for aach channel.   The first argument of the <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/auxchanneldata'>AuxChannelData</a> constructor is the &quot;input&quot; value.  This represents the external input value that produces this data.  This may be a quantity such as force in a stress analysis application or time in a simple animation.</p>
<pre class="no-line-numbers"><code class="language-typescript">    const radialDisplacementDataVector =
        [new AuxChannelData(0.0, zeroDisplacementData),
        new AuxChannelData(1.0, radialDisplacementData),
        new AuxChannelData(2.0, zeroDisplacementData)];
    const radialHeightDataVector =
        [new AuxChannelData(0.0, zeroScalarData),
        new AuxChannelData(1.0, radialHeightData),
        new AuxChannelData(2.0, zeroScalarData)];
    const radialSlopeDataVector =
        [new AuxChannelData(0.0, zeroScalarData),
        new AuxChannelData(1.0, radialSlopeData),
        new AuxChannelData(2.0, zeroScalarData)];</code></pre>
<p>  We next create the AuxChannels.  The channel names provideed in the <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/auxchannel'>AuxChannel</a> constructor are used to present the channel to the user as well as keys to select the channel from <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/imodeljs-common/rendering/analysisstyle'>AnalysisStyle</a>s.</p>
<pre class="no-line-numbers"><code class="language-typescript">    auxChannels.push(new AuxChannel(radialDisplacementDataVector, AuxChannelDataType.Vector, &quot;Radial Displacement&quot;, &quot;Radial: Time&quot;));
    auxChannels.push(new AuxChannel(radialHeightDataVector, AuxChannelDataType.Distance, &quot;Radial Height&quot;, &quot;Radial: Time&quot;));
    auxChannels.push(new AuxChannel(radialSlopeDataVector, AuxChannelDataType.Scalar, &quot;Radial Slope&quot;, &quot;Radial: Time&quot;));
</code></pre>
<p>The final step is to create <a href='https://imodeljs.github.io/iModelJs-docs-output//./reference/geometry-core/polyface/polyfaceauxdata'>PolyfaceAuxData</a> and associate it to our base `Polyface&apos;.  A set of indices is required to map the channel data values into the facets.  In our case, we have produced the channel data in parallel with the mesh points so that we can simply use point indices &quot;polyface.data.pointIndex&quot;, but this is not required and alternate indexing could also be used.  Not e that only a single index structure is supplied and shared by all channels and their data, therefore all channels data arrays must have same number of values and indexing.</p>
<pre class="no-line-numbers"><code class="language-typescript">    polyface.data.auxData = new PolyfaceAuxData(auxChannels, polyface.data.pointIndex);</code></pre>
<p>Run the example by entering &quot;node test-apps/analysis-importer/lib/Main.js&quot; in a command shell with CWD set to repository root.  The output is &quot;test-apps/analysis-importer/lib/output/AnalysisExample.bim&quot;.</p>
<script>$(document).ready(function () { Gifffer(); })</script>
            <p class='last-updated'>Last Updated:
                <span class='date-updated'>26 February, 2019</span>
            </p>
            <div id="imodeljs-github-comments">
            </div>
            
            <script>
              $(document).ready(function () {
                function initializeComments(repo) {
                  var s = document.createElement('script');
                  s.src = "https://imodeljs.github.io/iModelJs-docs-output//scripts/utterances/client.js";
                  s.setAttribute('repo', repo);
                  s.setAttribute('issue-term', 'title');
                  s.setAttribute('crossorigin', 'anonymous');
                  s.setAttribute('theme', 'github-light');
                  s.async = true;
            
                  document.getElementById("imodeljs-github-comments").appendChild(s);
                }
            
                var shouldShow = ldclient.variation(featureFlags.GithubIssuesFeedback);
            
                // shouldShow is undefined when ldclient has not emitted 'ready'.
                if (shouldShow === undefined) {
                  ldclient.on('ready', function () {
                    var gitIssueFlag = ldclient.variation(featureFlags.GithubIssuesFeedback);
                    var gitRepo = ldclient.variation(featureFlags.GitRepo);
                    if (gitIssueFlag) {
                      initializeComments(gitRepo);
                    }
                  });
                }
                else if (shouldShow) {
                  var gitRepo = ldclient.variation(featureFlags.GitRepo);
                  initializeComments(gitRepo);
                }
              });
            </script>
            
            <script type="text/javascript">
            
            </script>        </article>
    </div>
    <div class="toc-overlay"></div>
    <div id='inner-table-of-contents'>
       <!-- <div id='sticky-container' style="top: 76px; position: fixed;">
  <h4 class='heading'>On this page</h4>
    <div id="overview-container" class="clusterize-scroll">
      <ul id='nav' class='right-nav nav flex-column clusterize-content'>
              <li class='nav-item item '>
            <a class='title solo-title menu-text' href="#example">Example</a>
    </li>
 
      </ul>
    </div>
  </div>

 -->
    </div>
</div>

<!-- Footer -->
<footer class="page-footer font-small mdb-color pt-1 pb-3">
  <!-- Footer Links Container -->
  <div class="container text-center text-md-left">

    <!-- Grid row -->
    <div class="row d-flex align-items-center mt-2">

      <!-- Grid column -->
      <div class="col-md-7 col-lg-8 align-top d-none d-md-block">

        <a href="https://imodeljs.github.io/iModelJs-docs-output//" class="navbar-brand">
          <img id="site-logo" class="site-logo" style="zoom:75%;" src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/imodeljs-logo.svg" />
        </a>
        <small style="color: white; margin-right: 7px;"> powered by </small>
        <a href="https://www.bentley.com">
          <img href="https://www.bentley.com" id="sponsored-by-logo" class="sponsored-by-logo" style="zoom:75%; width: 162px; height: 37px;"
            src="https://imodeljs.github.io/iModelJs-docs-output//landing-page/assets/bentley.svg" />
        </a>
      </div>
      <!-- Grid column -->

      <!-- Grid column -->
      <div class="col-md-5 col-lg-4 ml-lg-0">

        <!-- Social buttons -->
        <div class="text-center text-md-right">
          <ul class="list-unstyled list-inline">
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://twitter.com/imodeljs" target="_blank">
                <i class="fa fa-twitter"></i>
              </a>
            </li>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://github.com/imodeljs" target="_blank">
                <i class="fa fa-github"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1" href="https://stackoverflow.com/tags/imodeljs"
                target="_blank">
                <i class="fa fa-stack-overflow"></i>
              </a>
            </li>
          </ul>
        </div>

      </div>
      <!-- Grid column -->

    </div>
    <!-- Grid row -->

  </div>
  <!-- Footer Links Container -->

</footer>
<!-- Footer -->

</div>
<a href="javascript:" id="return-to-top"><i class="icon icon-chevron-up"></i></a>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/bundle.js"></script>
</body>

</html><script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/monaco-editor/min/vs/loader.js"></script>
<script src="https://imodeljs.github.io/iModelJs-docs-output//scripts/ts-playground.js"></script>
